<dom-module id='nuxeo-my-rating'>
  <template>
    <style></style>
    <nuxeo-operation id="GetVote" op="GetVote" input="{{docId}}" response="{{response}}"></nuxeo-operation>
    <nuxeo-operation id="Vote" op="Vote" input="{{docId}}" params="{{params}}"></nuxeo-operation>
    <nuxeo-star-rating vote={{vote}}></nuxeo-star-rating>
  </template>
  <script>
    Polymer({
      is: 'nuxeo-my-rating',
      properties: {
        docId: {
          type: String,
          notify: true
        },
        params: {
          type: Object,
          notify: true
        },
        response: {
          type: Object,
          notify: true
        },
        vote: {
          type: Number,
          value: 0,
          notify: true
        },
        save: {
          type: Boolean,
          value: false
        }
      },

      observers: [
        'updateVote(vote)',
        'updateDocId(docId)',
        'processResponse(response)'
      ],

      ready: function() {
        console.log('--my rating ready');
      },

      processResponse: function() {
        if (this.response === undefined || this.response === null) {
          return;
        }
        var myvote = JSON.parse(this.response);
        this.vote = myvote.vote;
        this.save = true;
      },

      updateDocId: function() {
        if (this.docId === undefined) {
          return;
        }
        this.docId = this.docId.replace('/', '');
        this.$.GetVote.execute();
      },

      updateVote: function() {
        if (!this.save) {
          return;
        }
        this.params = {
          uservote: this.vote
        };
        this.$.Vote.execute();
      }

    });
  </script>
</dom-module>
